(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function o(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(e){if(e.ep)return;e.ep=!0;const n=o(e);fetch(e.href,n)}})();const S="https://api.real-debrid.com/rest/1.0",w=document.getElementById("rd-token"),h=document.getElementById("magnet-link"),a=document.getElementById("convert-btn"),y=document.getElementById("result-section"),m=document.getElementById("status-container"),E=document.getElementById("final-link"),L=document.getElementById("file-name"),u=document.getElementById("copy-btn"),b=document.getElementById("download-btn"),I=document.getElementById("reset-btn"),p=localStorage.getItem("rd_token");p&&(w.value=p);function c(i,s="info"){const o=document.createElement("div");o.className=`status ${s}`,o.textContent=i,m.innerHTML="",m.appendChild(o)}async function d(i,s="GET",o=null){const t=w.value.trim();if(!t)throw new Error("API Token is required");localStorage.setItem("rd_token",t);const e={Authorization:`Bearer ${t}`},n={method:s,headers:e};o&&(n.body=new URLSearchParams(o));try{const r=await fetch(`${S}${i}`,n);if(!r.ok){const f=await r.json().catch(()=>({}));throw new Error(f.error||`HTTP Error ${r.status}`)}return r.status===204?null:await r.json()}catch(r){throw r.message.includes("Failed to fetch")?new Error("CORS Error: Real-Debrid API blocked the request. Please use a CORS-unblocking browser extension or a proxy."):r}}async function v(){const i=h.value.trim();if(!i)return c("Please paste a magnet link","error");a.disabled=!0,a.querySelector(".btn-text").textContent="Processing...",a.querySelector(".loader").classList.remove("hidden"),m.innerHTML="";try{c("Step 1: Adding magnet to Real-Debrid...");const o=(await d("/torrents/addMagnet","POST",{magnet:i})).id;c("Step 2: Parsing metadata...");let t,e=0;for(;e<15&&(t=await d(`/torrents/info/${o}`),t.status!=="waiting_files_selection");){if(t.status==="error")throw new Error("Real-Debrid error while parsing magnet.");await new Promise(l=>setTimeout(l,1e3)),e++}if(t.status!=="waiting_files_selection")throw new Error("Timeout waiting for metadata selection.");c("Step 3: Selecting main file...");const r=t.files.sort((l,k)=>k.bytes-l.bytes)[0].id;if(await d(`/torrents/selectFiles/${o}`,"POST",{files:r}),c("Step 4: Generating download links..."),await new Promise(l=>setTimeout(l,2e3)),t=await d(`/torrents/info/${o}`),!t.links||t.links.length===0)throw new Error("No links found for this torrent.");const f=t.links[0];c("Step 5: Unrestricting link...");const g=await d("/unrestrict/link","POST",{link:f});L.textContent=g.filename||"Your file is ready",E.value=g.download,b.href=g.download,y.classList.remove("hidden"),a.classList.add("hidden"),c("Success!","info")}catch(s){c(s.message,"error"),console.error(s)}finally{a.disabled=!1,a.querySelector(".btn-text").textContent="Generate Direct Link",a.querySelector(".loader").classList.add("hidden")}}a.addEventListener("click",v);u.addEventListener("click",()=>{E.select(),document.execCommand("copy");const i=u.textContent;u.textContent="Copied!",setTimeout(()=>u.textContent=i,2e3)});I.addEventListener("click",()=>{y.classList.add("hidden"),a.classList.remove("hidden"),h.value="",m.innerHTML=""});
