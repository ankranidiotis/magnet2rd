(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}})();const P="https://api.real-debrid.com/rest/1.0",w=document.getElementById("rd-token"),E=document.getElementById("magnet-link"),c=document.getElementById("convert-btn"),k=document.getElementById("result-section"),p=document.getElementById("status-container"),S=document.getElementById("final-link"),x=document.getElementById("file-name"),m=document.getElementById("copy-btn"),v=document.getElementById("download-btn"),I=document.getElementById("reset-btn");let g=!1;const y=localStorage.getItem("rd_token");y&&(w.value=y);function l(i,s="info"){const r=document.createElement("div");r.className=`status ${s}`,r.textContent=i,p.innerHTML="",p.appendChild(r)}async function f(i,s="GET",r=null){const n=w.value.trim();if(!n)throw new Error("API Token is required");localStorage.setItem("rd_token",n);const e=`${P}${i}`;if(g)return await h(e,s,r);const o={Authorization:`Bearer ${n}`},a={method:s,headers:o};r&&(a.body=new URLSearchParams(r),a.headers["Content-Type"]="application/x-www-form-urlencoded");try{const t=await fetch(e,a);if(!t.ok){const d=await t.json().catch(()=>({}));throw new Error(d.error||`HTTP Error ${t.status}`)}return t.status===204?null:await t.json()}catch(t){if(t.message.includes("Failed to fetch")||t.message.includes("CORS"))return console.warn("Direct request blocked by CORS, activating sticky proxy..."),g=!0,await h(e,s,r);throw t}}async function h(i,s,r){const n=w.value.trim(),e=`https://corsproxy.io/?${encodeURIComponent(i)}`,o={Authorization:`Bearer ${n}`},a={method:s,headers:o};r&&(a.body=new URLSearchParams(r),a.headers["Content-Type"]="application/x-www-form-urlencoded");try{const t=await fetch(e,a);if(!t.ok){const d=await t.json().catch(()=>({}));throw new Error(d.error||`Proxy Error: ${t.status} at ${i.split("/").pop()}`)}return t.status===204?null:await t.json()}catch(t){throw console.error("Proxy Error Details:",t),new Error(`CORS Proxy failed during ${i.split("/").pop()}. Please try again or use a browser extension.`)}}async function T(){const i=E.value.trim();if(!i)return l("Please paste a magnet link","error");c.disabled=!0,c.querySelector(".btn-text").textContent="Processing...",c.querySelector(".loader").classList.remove("hidden"),p.innerHTML="";try{l("Step 1: Adding magnet to Real-Debrid...");const r=(await f("/torrents/addMagnet","POST",{magnet:i})).id;l("Step 2: Parsing metadata...");let n,e=0;for(;e<20&&(n=await f(`/torrents/info/${r}?t=${Date.now()}`),n.status!=="waiting_files_selection");){if(n.status==="error")throw new Error("Real-Debrid error while parsing magnet.");await new Promise(u=>setTimeout(u,1500)),e++}if(n.status!=="waiting_files_selection")throw new Error("Timeout waiting for metadata selection.");l("Step 3: Selecting main file...");const a=n.files.sort((u,L)=>L.bytes-u.bytes)[0].id;if(await f(`/torrents/selectFiles/${r}`,"POST",{files:a}),l("Step 4: Generating download links..."),await new Promise(u=>setTimeout(u,3e3)),n=await f(`/torrents/info/${r}?t=${Date.now()}`),!n.links||n.links.length===0)throw new Error("No links found for this torrent.");const t=n.links[0];l("Step 5: Unrestricting link...");const d=await f("/unrestrict/link","POST",{link:t});x.textContent=d.filename||"Your file is ready",S.value=d.download,v.href=d.download,k.classList.remove("hidden"),c.classList.add("hidden"),l("Success!","info")}catch(s){l(s.message,"error"),console.error(s)}finally{c.disabled=!1,c.querySelector(".btn-text").textContent="Generate Direct Link",c.querySelector(".loader").classList.add("hidden")}}c.addEventListener("click",T);m.addEventListener("click",()=>{S.select(),document.execCommand("copy");const i=m.textContent;m.textContent="Copied!",setTimeout(()=>m.textContent=i,2e3)});I.addEventListener("click",()=>{k.classList.add("hidden"),c.classList.remove("hidden"),E.value="",p.innerHTML=""});
