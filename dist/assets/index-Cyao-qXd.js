(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function n(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(t){if(t.ep)return;t.ep=!0;const r=n(t);fetch(t.href,r)}})();const S="https://api.real-debrid.com/rest/1.0",y=document.getElementById("rd-token"),p=document.getElementById("magnet-link"),c=document.getElementById("convert-btn"),h=document.getElementById("result-section"),g=document.getElementById("status-container"),E=document.getElementById("final-link"),L=document.getElementById("file-name"),m=document.getElementById("copy-btn"),b=document.getElementById("download-btn"),I=document.getElementById("reset-btn"),w=localStorage.getItem("rd_token");w&&(y.value=w);function l(s,o="info"){const n=document.createElement("div");n.className=`status ${o}`,n.textContent=s,g.innerHTML="",g.appendChild(n)}async function f(s,o="GET",n=null){const e=y.value.trim();if(!e)throw new Error("API Token is required");localStorage.setItem("rd_token",e);const t=`${S}${s}`,r={Authorization:`Bearer ${e}`},a={method:o,headers:r};n&&(a.body=new URLSearchParams(n));try{const i=await fetch(t,a);if(!i.ok){const d=await i.json().catch(()=>({}));throw new Error(d.error||`HTTP Error ${i.status}`)}return i.status===204?null:await i.json()}catch(i){if(i.message.includes("Failed to fetch")||i.message.includes("CORS"))return console.warn("Direct request blocked by CORS, trying proxy..."),await P(t,a);throw i}}async function P(s,o){const n=`https://corsproxy.io/?${encodeURIComponent(s)}`;try{const e=await fetch(n,o);if(!e.ok){const t=await e.json().catch(()=>({}));throw new Error(t.error||`Proxy Error: ${e.status}`)}return e.status===204?null:await e.json()}catch{throw new Error("CORS Proxy failed. Please use a CORS-unblocking browser extension or try again later.")}}async function v(){const s=p.value.trim();if(!s)return l("Please paste a magnet link","error");c.disabled=!0,c.querySelector(".btn-text").textContent="Processing...",c.querySelector(".loader").classList.remove("hidden"),g.innerHTML="";try{l("Step 1: Adding magnet to Real-Debrid...");const n=(await f("/torrents/addMagnet","POST",{magnet:s})).id;l("Step 2: Parsing metadata...");let e,t=0;for(;t<15&&(e=await f(`/torrents/info/${n}`),e.status!=="waiting_files_selection");){if(e.status==="error")throw new Error("Real-Debrid error while parsing magnet.");await new Promise(u=>setTimeout(u,1e3)),t++}if(e.status!=="waiting_files_selection")throw new Error("Timeout waiting for metadata selection.");l("Step 3: Selecting main file...");const a=e.files.sort((u,k)=>k.bytes-u.bytes)[0].id;if(await f(`/torrents/selectFiles/${n}`,"POST",{files:a}),l("Step 4: Generating download links..."),await new Promise(u=>setTimeout(u,2e3)),e=await f(`/torrents/info/${n}`),!e.links||e.links.length===0)throw new Error("No links found for this torrent.");const i=e.links[0];l("Step 5: Unrestricting link...");const d=await f("/unrestrict/link","POST",{link:i});L.textContent=d.filename||"Your file is ready",E.value=d.download,b.href=d.download,h.classList.remove("hidden"),c.classList.add("hidden"),l("Success!","info")}catch(o){l(o.message,"error"),console.error(o)}finally{c.disabled=!1,c.querySelector(".btn-text").textContent="Generate Direct Link",c.querySelector(".loader").classList.add("hidden")}}c.addEventListener("click",v);m.addEventListener("click",()=>{E.select(),document.execCommand("copy");const s=m.textContent;m.textContent="Copied!",setTimeout(()=>m.textContent=s,2e3)});I.addEventListener("click",()=>{h.classList.add("hidden"),c.classList.remove("hidden"),p.value="",g.innerHTML=""});
